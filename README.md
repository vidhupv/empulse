# EmPulse - Employee Engagement Pulse Dashboard

A Next.js application that provides managers with real-time sentiment analysis and insights from Slack channels using AI-powered analysis.

## Features

- **Real-time Sentiment Analysis**: Monitor team sentiment across Slack channels
- **AI-Powered Insights**: Weekly recommendations generated by Claude AI
- **Burnout Detection**: Early warning system for team wellness
- **Manager Dashboard**: Clean, actionable interface for team leaders
- **Multi-Channel Monitoring**: Track sentiment across multiple Slack channels
- **Trend Analysis**: Identify improving/declining team morale patterns

## Tech Stack

- **Frontend**: Next.js 14, TypeScript, Tailwind CSS
- **Backend**: Next.js API Routes
- **Database**: MongoDB with Mongoose
- **AI**: Anthropic Claude API (Haiku for sentiment, Sonnet for insights)
- **Integrations**: Slack Web API & Events API
- **Charts**: Recharts
- **Icons**: Lucide React

## Setup Instructions

### 1. Prerequisites

- Node.js 18+ 
- MongoDB instance (local or MongoDB Atlas)
- Slack workspace with admin permissions
- Anthropic Claude API key

### 2. Environment Setup

Copy `.env.example` to `.env.local` and fill in your values:

```bash
cp .env.example .env.local
```

Required environment variables:
```
MONGODB_URI=mongodb://localhost:27017/empulse
ANTHROPIC_API_KEY=your_anthropic_api_key_here
SLACK_BOT_TOKEN=xoxb-your-slack-bot-token
SLACK_SIGNING_SECRET=your_slack_signing_secret
SLACK_CLIENT_ID=your_slack_client_id
SLACK_CLIENT_SECRET=your_slack_client_secret
NEXTAUTH_SECRET=your_nextauth_secret_here
NEXTAUTH_URL=http://localhost:3000
SLACK_WEBHOOK_URL=http://localhost:3000/api/slack/events
```

### 3. Slack App Setup

1. Go to [Slack API](https://api.slack.com/apps) and create a new app
2. Choose "From scratch" and select your workspace
3. In **OAuth & Permissions**, add these scopes:
   - `channels:history` - Read messages from public channels
   - `channels:read` - View basic information about channels
   - `groups:history` - Read messages from private channels (optional)
   - `groups:read` - View basic information about private channels (optional)
   - `users:read` - View people in the workspace
   - `reactions:read` - View emoji reactions

4. In **Event Subscriptions**:
   - Enable events
   - Set Request URL to your webhook endpoint (e.g., `https://your-domain.com/api/slack/events`)
   - Subscribe to these events:
     - `message.channels` - Listen for messages in public channels
     - `message.groups` - Listen for messages in private channels (optional)
     - `reaction_added` - Listen for emoji reactions
     - `reaction_removed` - Listen for emoji reaction removals

5. Install the app to your workspace and copy the tokens to your _.env.local

### 4. Installation

```bash
# Install dependencies
npm install

# Start development server
npm run dev
```

Visit [http://localhost:3000](http://localhost:3000) to see the application.

### 5. Initial Setup

1. Add the Slack bot to channels you want to monitor
2. Use the "Add Channels" button in the dashboard to select channels
3. Run backfill to process historical data:
   ```bash
   curl -X POST http://localhost:3000/api/aggregation/backfill \
     -H "Content-Type: application/json" \
     -d '{"days": 7}'
   ```

## Usage

### Adding Channels
1. Invite the EmPulse bot to your Slack channels
2. Click "Add Channels" in the dashboard
3. Select channels to monitor
4. Bot will start analyzing new messages in real-time

### Reading Insights
- **Dashboard Overview**: See overall team sentiment and trends
- **Channel Details**: Drill down into specific channel metrics
- **Weekly Insights**: AI-generated recommendations for managers
- **Burnout Alerts**: Early warning signs requiring attention

### Interpreting Sentiment Scores
- **Green (60%+)**: Positive team sentiment
- **Yellow (40-60%)**: Neutral sentiment
- **Red (<40%)**: Negative sentiment requiring attention

## API Endpoints

### Slack Integration
- `POST /api/slack/events` - Webhook for Slack events
- `GET /api/channels` - List available and monitored channels
- `POST /api/channels` - Add channels to monitoring
- `DELETE /api/channels` - Remove channel from monitoring

### Data Aggregation
- `POST /api/aggregation/daily` - Trigger daily aggregation
- `POST /api/aggregation/weekly` - Generate weekly insights
- `POST /api/aggregation/backfill` - Backfill historical data

### Dashboard Data
- `GET /api/dashboard/data?type=sentiment&timeframe=7d` - Sentiment trends
- `GET /api/dashboard/data?type=insights` - Weekly insights
- `GET /api/dashboard/data?type=burnout` - Burnout alerts

## Architecture

### Sentiment Analysis Pipeline
1. **Message Ingestion**: Slack webhook receives messages
2. **Text Processing**: Clean and normalize message content
3. **AI Analysis**: Claude Haiku analyzes sentiment (cost-efficient)
4. **Data Storage**: Store results in MongoDB
5. **Aggregation**: Daily rollups and trend calculation

### Weekly Insights Generation
1. **Data Collection**: Aggregate daily sentiment data
2. **Pattern Analysis**: Identify trends and anomalies
3. **AI Insights**: Claude Sonnet generates recommendations
4. **Alert Generation**: Detect burnout signals

### Cost Optimization
- **Claude Haiku**: Used for high-volume sentiment analysis (~$0.25/1M tokens)
- **Claude Sonnet**: Used for complex weekly insights (~$3/1M tokens)
- **Estimated Cost**: ~$1-5/month for typical team usage

## License

MIT License - see LICENSE file for details.